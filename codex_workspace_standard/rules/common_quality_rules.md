# AI駆動開発 共通品質ルール
> Qiita:とまだ氏「【コピペOK】AIエージェントで良いコードを書く！」の記事をもとに、Codex/Cursor/Copilot共通で使えるルールセットを作成しました。`~/.codex/AGENTS.md` や `.claude/CLAUDE.md` にも流用できます。

## 開発の原則
- 動くだけでなく、品質・保守性・安全性を常に意識する。
- ボーイスカウトルール：触れた箇所は必ず良い状態で返す。
- 問題を見つけたら放置せず、修正またはTODO/ADRで明示する。
- **言語ルール**: 英語で思考・設計判断を整理し、回答/コード/ファイル生成/コミットメッセージは必ず日本語で記述する。
- **開発フェーズ**: PoC → Pilot → 実機テスト（負荷/セキュリティ）→ 製品初版の順で進め、各段階ごとに専用ブランチを作成して成果を管理し、最終版のみ `main` へ統合する。
- **SBOM/IEC 62443**: 使用するOSS・依存関係はSBOMに記録し、Pilot段階からIEC 62443準拠のセキュリティ設計・レビューを必須化する。

## エラーハンドリング
- 例外を握りつぶさず、根本原因を特定して修正。
- 外部API/ネットワークは必ず失敗前提（リトライやタイムアウト設定）。
- エラーケースもテスト対象に含める。

## コード品質
- DRY、意味ある命名、一貫したスタイル。
- コメントは「なぜ」を説明し、「何を」はコードで表現。
- 使われていないコードや依存は即削除。
- 生成したファイルやテンプレートにも日本語で目的・使い方を記す。

## テスト規律
- `npm run test` / `pytest` / `plc_unit_test` など、プロジェクト標準を守る。
- 実装詳細ではなく振る舞いをテストし、順序依存を避ける。

## セキュリティ & 信頼性
- 秘密情報は環境変数。ハードコード禁止。
- 入力は必ず検証し、最小権限で実行。
- ログ/メトリクスで可観測性を確保し、障害時にはリトライ＋サーキットブレーカーを検討。
- Pilot以降はIEC 62443準拠のセキュリティ要件（リスク分析・脆弱性管理・アクセス制御）を設計書およびSBOMに反映する。

## パフォーマンス & スケーラビリティ
- 推測で最適化せず、計測に基づく。
- 不要なI/OやN+1を避け、キャッシュや遅延読み込みを活用。
- 将来の負荷増に備え、並列化やリソース増設を想定。
- Docker / コンテナ運用は Compose v2 (`docker compose` CLI) のみ使用し、`docker compose config` で検証する。

## Git / レビュー / ドキュメント
- コンベンショナルコミット、原子的コミット、mainへの直コミット禁止。
- レビューは建設的に、変更理由と影響を明示。
- README/ADRを常に最新に保つ。重要判断は文章化。
- PoC/Pilot/実機/製品初版それぞれで必要なマニュアル（ユーザー向け・オペレーター向け）とSBOM・テストレポートを必ず残す。

## 運用
- ルールファイルの更新はCodexにも共有し、整合性を取る。
- プロジェクト固有の追加ルールは `codex_workspace_standard/templates/specs_template.md` や `amazon_q_best_practices.md` に連携する。
